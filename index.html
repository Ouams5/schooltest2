<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BNI Yekhlef Highschool â€” Student Portal</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
<style>
/* --- ENHANCED UI STYLES --- */
:root {
  --bg: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  --surface: #ffffff;
  --surface-secondary: #f8fafc;
  --muted: #64748b;
  --primary: #1e40af;
  --primary-light: #3b82f6;
  --accent: #475569;
  --danger: #ef4444;
  --success: #10b981;
  --warning: #f59e0b;
  --info: #3b82f6;
  --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  --radius: 12px;
  --radius-sm: 8px;
  --maxWidth: 1400px;
  --gap: 20px;
  --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  font-family: 'Poppins', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  margin: 0;
  padding: 24px;
  background: var(--bg);
  font-family: var(--font);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  display: flex;
  justify-content: center;
  color: var(--primary);
  min-height: 100vh;
}

.app {
  display: grid;
  grid-template-columns: 280px 1fr;
  gap: var(--gap);
  width: 100%;
  max-width: var(--maxWidth);
  align-items: start;
}

/* Enhanced Sidebar */
.sidebar {
  background: var(--surface);
  border-radius: var(--radius);
  padding: 20px;
  box-shadow: var(--shadow-lg);
  position: sticky;
  top: 24px;
  height: calc(100vh - 48px);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  border: 1px solid #e2e8f0;
}

.sidebar-content {
  flex: 1;
  overflow-y: auto;
}

.sidebar-footer {
  padding-top: 16px;
  border-top: 1px solid #e2e8f0;
}

.brand {
  display: flex;
  gap: 12px;
  align-items: center;
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 1px solid #e2e8f0;
}

.logo {
  width: 48px;
  height: 48px;
  background: linear-gradient(135deg, var(--primary), var(--primary-light));
  border-radius: 12px;
  color: white;
  font-weight: 700;
  font-size: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: var(--shadow);
}

.brand .title {
  font-weight: 700;
  font-size: 18px;
  color: var(--primary);
}

.brand .sub {
  font-size: 12px;
  color: var(--muted);
  font-weight: 500;
}

.sidebar-nav {
  display: flex;
  flex-direction: column;
  gap: 4px;
  margin-bottom: 20px;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  border-radius: var(--radius-sm);
  font-weight: 500;
  color: var(--primary);
  cursor: pointer;
  transition: var(--transition);
  border: 1px solid transparent;
}

.nav-item:hover {
  background: var(--surface-secondary);
  border-color: #e2e8f0;
  transform: translateX(4px);
}

.nav-item.active {
  background: linear-gradient(90deg, rgba(59, 130, 246, 0.1), rgba(59, 130, 246, 0.05));
  border-left: 4px solid var(--primary-light);
  padding-left: 12px;
  color: var(--primary-light);
}

.nav-item.active .icon {
  color: var(--primary-light);
}

.nav-item .badge {
  margin-left: auto;
  background: var(--primary-light);
  color: white;
  font-size: 11px;
  padding: 2px 8px;
  border-radius: 12px;
}

.icon {
  font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
  font-size: 20px;
  color: var(--primary);
}

.profile-card {
  padding: 16px;
  border-radius: var(--radius-sm);
  background: linear-gradient(135deg, var(--surface-secondary), #fff);
  border: 1px solid #e2e8f0;
  margin-bottom: 20px;
}

.profile-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.profile-avatar {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid var(--primary-light);
  background: linear-gradient(135deg, var(--primary), var(--primary-light));
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 600;
  font-size: 18px;
}

.profile-info {
  flex: 1;
}

.profile-name {
  font-weight: 600;
  font-size: 15px;
  margin-bottom: 2px;
}

.profile-role {
  font-size: 12px;
  color: var(--muted);
  font-weight: 500;
}

.profile-stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px;
  margin-top: 12px;
}

.profile-stat {
  text-align: center;
  padding: 8px;
  background: white;
  border-radius: var(--radius-sm);
  border: 1px solid #e2e8f0;
}

.profile-stat-value {
  font-weight: 700;
  color: var(--primary);
  font-size: 14px;
}

.profile-stat-label {
  font-size: 11px;
  color: var(--muted);
  margin-top: 2px;
}

/* Enhanced Main Content */
.main {
  display: flex;
  flex-direction: column;
  gap: var(--gap);
}

.topbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 0;
}

.search-container {
  flex: 1;
  max-width: 600px;
}

.search {
  display: flex;
  align-items: center;
  gap: 12px;
  background: var(--surface);
  border-radius: var(--radius);
  padding: 12px 16px;
  box-shadow: var(--shadow);
  border: 1px solid transparent;
  transition: var(--transition);
}

.search:focus-within {
  border-color: var(--primary-light);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.search input {
  border: 0;
  outline: 0;
  background: transparent;
  width: 100%;
  font-size: 14px;
  color: var(--primary);
}

.search input::placeholder {
  color: var(--muted);
}

.top-actions {
  display: flex;
  gap: 12px;
  align-items: center;
}

.welcome-container {
  text-align: right;
}

.welcome-text {
  font-weight: 600;
  font-size: 15px;
}

.welcome-sub {
  font-size: 12px;
  color: var(--muted);
}

.notification-bell {
  position: relative;
  cursor: pointer;
  padding: 8px;
  border-radius: var(--radius-sm);
  transition: var(--transition);
}

.notification-bell:hover {
  background: var(--surface-secondary);
}

.notification-badge {
  position: absolute;
  top: -2px;
  right: -2px;
  background: var(--danger);
  color: white;
  font-size: 10px;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Enhanced Cards */
.card {
  background: var(--surface);
  border-radius: var(--radius);
  padding: 24px;
  box-shadow: var(--shadow);
  border: 1px solid #e2e8f0;
  transition: var(--transition);
}

.card:hover {
  box-shadow: var(--shadow-lg);
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 1px solid #e2e8f0;
}

.card-title {
  font-weight: 600;
  font-size: 18px;
  color: var(--primary);
}

.card-actions {
  display: flex;
  gap: 8px;
}

/* Enhanced Grid */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 16px;
}

/* Enhanced List Items */
.list-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  border-radius: var(--radius-sm);
  border: 1px solid #e2e8f0;
  margin-bottom: 8px;
  background: #fff;
  transition: var(--transition);
}

.list-item:hover {
  border-color: var(--primary-light);
  transform: translateY(-2px);
  box-shadow: var(--shadow);
}

.list-item-content {
  flex: 1;
}

.list-item-title {
  font-weight: 600;
  margin-bottom: 4px;
  color: var(--primary);
}

.list-item-subtitle {
  font-size: 14px;
  color: var(--muted);
  margin-bottom: 8px;
}

.list-item-meta {
  display: flex;
  gap: 12px;
  font-size: 12px;
  color: var(--muted);
}

.list-item-actions {
  display: flex;
  gap: 8px;
}

/* Enhanced Chat */
.chat-area {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.chat-window {
  height: 400px;
  border-radius: var(--radius);
  border: 1px solid #e2e8f0;
  padding: 16px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  background: #f8fbff;
}

.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding-right: 8px;
}

.message {
  padding: 12px;
  border-radius: var(--radius-sm);
  background: white;
  margin-bottom: 12px;
  border: 1px solid #e2e8f0;
  max-width: 80%;
}

.message.sent {
  margin-left: auto;
  background: linear-gradient(135deg, var(--primary-light), #2563eb);
  color: white;
  border: none;
}

.message .meta {
  font-size: 12px;
  color: var(--muted);
  margin-bottom: 6px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.message.sent .meta {
  color: rgba(255, 255, 255, 0.9);
}

.message-sender {
  font-weight: 600;
}

.message-time {
  font-size: 11px;
}

.message-text {
  line-height: 1.5;
}

.chat-input-container {
  display: flex;
  gap: 12px;
  align-items: center;
}

.chat-input {
  flex: 1;
  padding: 14px;
  border-radius: var(--radius);
  border: 1px solid #e2e8f0;
  background: #ffffff;
  font-family: inherit;
  font-size: 14px;
  transition: var(--transition);
}

.chat-input:focus {
  outline: none;
  border-color: var(--primary-light);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

/* Enhanced Buttons */
.btn {
  padding: 10px 16px;
  border-radius: var(--radius-sm);
  border: 0;
  background: var(--primary);
  color: white;
  cursor: pointer;
  font-weight: 600;
  font-size: 14px;
  transition: var(--transition);
  display: inline-flex;
  align-items: center;
  gap: 8px;
  justify-content: center;
}

.btn:hover {
  background: var(--primary-light);
  transform: translateY(-2px);
  box-shadow: var(--shadow);
}

.btn:active {
  transform: translateY(0);
}

.btn.primary {
  background: var(--primary-light);
}

.btn.primary:hover {
  background: #2563eb;
}

.btn.success {
  background: var(--success);
}

.btn.success:hover {
  background: #059669;
}

.btn.warning {
  background: var(--warning);
}

.btn.warning:hover {
  background: #d97706;
}

.btn.danger {
  background: var(--danger);
}

.btn.danger:hover {
  background: #dc2626;
}

.btn.ghost {
  background: transparent;
  border: 1px solid #e2e8f0;
  color: var(--primary);
}

.btn.ghost:hover {
  background: var(--surface-secondary);
  border-color: var(--primary-light);
  color: var(--primary-light);
}

.btn.sm {
  padding: 6px 12px;
  font-size: 12px;
}

.btn.lg {
  padding: 14px 24px;
  font-size: 16px;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none !important;
}

.btn-icon {
  width: 36px;
  height: 36px;
  padding: 0;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Enhanced Modals */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.7);
  align-items: center;
  justify-content: center;
  z-index: 1000;
  backdrop-filter: blur(4px);
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.modal {
  background: var(--surface);
  padding: 32px;
  border-radius: var(--radius);
  max-width: 500px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: var(--shadow-lg);
  animation: slideUp 0.3s ease;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 1px solid #e2e8f0;
}

.modal-title {
  font-weight: 600;
  font-size: 20px;
  color: var(--primary);
}

.modal-close {
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 8px;
  border-radius: var(--radius-sm);
  transition: var(--transition);
}

.modal-close:hover {
  background: var(--surface-secondary);
}

.modal-body {
  margin-bottom: 24px;
}

.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  padding-top: 16px;
  border-top: 1px solid #e2e8f0;
}

/* Enhanced Forms */
.form-group {
  margin-bottom: 16px;
}

.form-label {
  display: block;
  margin-bottom: 6px;
  font-weight: 500;
  color: var(--primary);
  font-size: 14px;
}

.form-control {
  width: 100%;
  padding: 12px;
  border-radius: var(--radius-sm);
  border: 1px solid #e2e8f0;
  background: white;
  font-family: inherit;
  font-size: 14px;
  transition: var(--transition);
}

.form-control:focus {
  outline: none;
  border-color: var(--primary-light);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.form-control.error {
  border-color: var(--danger);
}

.form-error {
  color: var(--danger);
  font-size: 12px;
  margin-top: 4px;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.form-textarea {
  min-height: 100px;
  resize: vertical;
}

.form-select {
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 16px;
  padding-right: 36px;
}

/* Enhanced Toast */
.toast-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1001;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.toast {
  background: var(--surface);
  padding: 16px;
  border-radius: var(--radius-sm);
  box-shadow: var(--shadow-lg);
  min-width: 300px;
  max-width: 400px;
  display: flex;
  align-items: flex-start;
  gap: 12px;
  transform: translateX(150%);
  transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  border-left: 4px solid transparent;
}

.toast.show {
  transform: translateX(0);
}

.toast.success {
  border-left-color: var(--success);
}

.toast.error {
  border-left-color: var(--danger);
}

.toast.warning {
  border-left-color: var(--warning);
}

.toast.info {
  border-left-color: var(--info);
}

.toast-icon {
  font-size: 20px;
}

.toast-success .toast-icon {
  color: var(--success);
}

.toast-error .toast-icon {
  color: var(--danger);
}

.toast-warning .toast-icon {
  color: var(--warning);
}

.toast-info .toast-icon {
  color: var(--info);
}

.toast-content {
  flex: 1;
}

.toast-title {
  font-weight: 600;
  font-size: 14px;
  margin-bottom: 4px;
}

.toast-message {
  font-size: 13px;
  color: var(--muted);
  line-height: 1.4;
}

.toast-close {
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 2px;
  border-radius: 4px;
  color: var(--muted);
  transition: var(--transition);
}

.toast-close:hover {
  color: var(--primary);
  background: var(--surface-secondary);
}

/* Enhanced Loading */
.loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(59, 130, 246, 0.3);
  border-radius: 50%;
  border-top-color: var(--primary-light);
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

.loading-overlay {
  position: fixed;
  inset: 0;
  background: rgba(255, 255, 255, 0.9);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1002;
  backdrop-filter: blur(4px);
}

.loading-overlay.show {
  display: flex;
}

.loading-content {
  text-align: center;
}

.loading-spinner {
  width: 48px;
  height: 48px;
  border: 4px solid rgba(59, 130, 246, 0.3);
  border-radius: 50%;
  border-top-color: var(--primary-light);
  animation: spin 1s linear infinite;
  margin-bottom: 16px;
}

/* Enhanced Profile */
.profile-form {
  display: flex;
  flex-direction: column;
  gap: 16px;
  max-width: 500px;
}

.profile-avatar-upload {
  position: relative;
  width: 100px;
  height: 100px;
}

.profile-avatar-upload img {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid var(--primary-light);
}

.profile-avatar-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: var(--transition);
  cursor: pointer;
}

.profile-avatar-upload:hover .profile-avatar-overlay {
  opacity: 1;
}

.profile-avatar-overlay span {
  color: white;
  font-size: 24px;
}

/* Enhanced Admin */
.admin-controls {
  display: flex;
  gap: 12px;
  margin-bottom: 24px;
  flex-wrap: wrap;
}

.admin-table-container {
  overflow-x: auto;
  border-radius: var(--radius-sm);
  border: 1px solid #e2e8f0;
}

.admin-table {
  width: 100%;
  border-collapse: collapse;
  min-width: 800px;
}

.admin-table th {
  background: var(--surface-secondary);
  font-weight: 600;
  text-align: left;
  padding: 16px;
  border-bottom: 2px solid #e2e8f0;
  color: var(--primary);
}

.admin-table td {
  padding: 16px;
  border-bottom: 1px solid #e2e8f0;
}

.admin-table tr:hover {
  background: var(--surface-secondary);
}

/* Enhanced Club System */
.club-card {
  border: 1px solid #e2e8f0;
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 16px;
  background: white;
  transition: var(--transition);
}

.club-card:hover {
  border-color: var(--primary-light);
  transform: translateY(-2px);
  box-shadow: var(--shadow);
}

.club-header {
  display: flex;
  align-items: flex-start;
  gap: 16px;
  margin-bottom: 16px;
}

.club-logo {
  width: 64px;
  height: 64px;
  border-radius: var(--radius-sm);
  object-fit: cover;
  border: 2px solid #e2e8f0;
  background: var(--surface-secondary);
  display: flex;
  align-items: center;
  justify-content: center;
}

.club-logo span {
  font-size: 32px;
  color: var(--muted);
}

.club-info {
  flex: 1;
}

.club-name {
  font-weight: 700;
  font-size: 20px;
  margin: 0 0 4px 0;
  color: var(--primary);
}

.club-abbr {
  font-size: 14px;
  color: var(--muted);
  margin: 0 0 8px 0;
  font-weight: 500;
}

.club-leaders {
  font-size: 14px;
  color: var(--accent);
  margin: 0 0 12px 0;
}

.club-description {
  font-size: 14px;
  line-height: 1.5;
  color: var(--primary);
  margin: 0 0 16px 0;
}

.club-stats {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
  margin-top: 16px;
}

.club-stat {
  text-align: center;
  padding: 12px;
  background: var(--surface-secondary);
  border-radius: var(--radius-sm);
  border: 1px solid #e2e8f0;
}

.club-stat-value {
  font-weight: 700;
  font-size: 20px;
  color: var(--primary);
  margin-bottom: 4px;
}

.club-stat-label {
  font-size: 12px;
  color: var(--muted);
  font-weight: 500;
}

.club-actions {
  display: flex;
  gap: 8px;
  margin-top: 16px;
}

/* Role Badges */
.role-badge {
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

.role-admin {
  background: linear-gradient(135deg, #fef2f2, #fee2e2);
  color: #dc2626;
  border: 1px solid #fecaca;
}

.role-leader {
  background: linear-gradient(135deg, #fffbeb, #fef3c7);
  color: #d97706;
  border: 1px solid #fde68a;
}

.role-student {
  background: linear-gradient(135deg, #eff6ff, #dbeafe);
  color: #2563eb;
  border: 1px solid #bfdbfe;
}

.role-owner {
  background: linear-gradient(135deg, #f5f3ff, #ede9fe);
  color: #7c3aed;
  border: 1px solid #ddd6fe;
}

/* Status Badges */
.status-badge {
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 600;
}

.status-active {
  background: #d1fae5;
  color: #065f46;
}

.status-pending {
  background: #fef3c7;
  color: #92400e;
}

.status-inactive {
  background: #f3f4f6;
  color: #374151;
}

/* Dashboard Widgets */
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 20px;
}

.dashboard-widget {
  background: white;
  border-radius: var(--radius);
  padding: 20px;
  border: 1px solid #e2e8f0;
  transition: var(--transition);
}

.dashboard-widget:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow);
}

.widget-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
}

.widget-icon {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--surface-secondary);
  color: var(--primary-light);
}

.widget-title {
  font-weight: 600;
  font-size: 16px;
  color: var(--primary);
}

.widget-value {
  font-weight: 700;
  font-size: 32px;
  color: var(--primary);
  margin-bottom: 8px;
}

.widget-trend {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 12px;
  font-weight: 500;
}

.widget-trend.up {
  color: var(--success);
}

.widget-trend.down {
  color: var(--danger);
}

/* Language Switcher */
.language-switcher {
  position: relative;
}

.language-btn {
  padding: 8px 12px;
  border-radius: var(--radius-sm);
  background: var(--surface);
  border: 1px solid #e2e8f0;
  color: var(--primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 500;
  transition: var(--transition);
}

.language-btn:hover {
  background: var(--surface-secondary);
  border-color: var(--primary-light);
}

.language-dropdown {
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 4px;
  background: var(--surface);
  border: 1px solid #e2e8f0;
  border-radius: var(--radius-sm);
  box-shadow: var(--shadow-lg);
  min-width: 120px;
  display: none;
  z-index: 100;
}

.language-dropdown.show {
  display: block;
}

.language-option {
  padding: 10px 16px;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  gap: 8px;
}

.language-option:hover {
  background: var(--surface-secondary);
}

.language-option.active {
  color: var(--primary-light);
  font-weight: 600;
}

/* Responsive Design */
@media (max-width: 1024px) {
  .app {
    grid-template-columns: 1fr;
    padding-bottom: 80px;
  }
  
  .sidebar {
    position: relative;
    height: auto;
    top: 0;
  }
  
  .sidebar-content {
    max-height: 400px;
  }
  
  .search-container {
    max-width: 100%;
  }
  
  .dashboard-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 768px) {
  body {
    padding: 16px;
  }
  
  .card {
    padding: 20px;
  }
  
  .dashboard-grid {
    grid-template-columns: 1fr;
  }
  
  .club-stats {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .form-row {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 480px) {
  .top-actions {
    flex-direction: column;
    align-items: flex-end;
  }
  
  .club-header {
    flex-direction: column;
    align-items: center;
    text-align: center;
  }
  
  .club-logo {
    width: 80px;
    height: 80px;
  }
  
  .modal {
    padding: 20px;
    width: 95%;
  }
}

/* Dark Mode Support */
@media (prefers-color-scheme: dark) {
  :root {
    --bg: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    --surface: #1e293b;
    --surface-secondary: #334155;
    --muted: #94a3b8;
    --primary: #f1f5f9;
    --primary-light: #60a5fa;
    --accent: #cbd5e1;
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
  }
  
  body {
    color: var(--primary);
  }
  
  .search {
    background: var(--surface-secondary);
  }
  
  .list-item {
    background: var(--surface-secondary);
  }
  
  .club-card {
    background: var(--surface-secondary);
  }
  
  .club-stat {
    background: var(--surface);
  }
  
  .dashboard-widget {
    background: var(--surface-secondary);
  }
  
  .admin-table th {
    background: var(--surface);
  }
}

/* Accessibility Improvements */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

.focus-visible {
  outline: 2px solid var(--primary-light);
  outline-offset: 2px;
}
</style>
</head>
<body>
<div class="app">
  <!-- Enhanced Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-content">
      <div class="brand">
        <div class="logo">BY</div>
        <div>
          <div class="title">BNI Yekhlef Highschool</div>
          <div class="sub">Student Portal</div>
        </div>
      </div>
      
      <nav class="sidebar-nav">
        <div class="nav-item active" data-tab="dashboard" tabindex="0">
          <span class="material-symbols-outlined icon">dashboard</span>Dashboard
        </div>
        <div class="nav-item" data-tab="projects" tabindex="0">
          <span class="material-symbols-outlined icon">work</span>Projects
        </div>
        <div class="nav-item" data-tab="assignments" tabindex="0">
          <span class="material-symbols-outlined icon">assignment</span>Assignments
        </div>
        <div class="nav-item" data-tab="events" tabindex="0">
          <span class="material-symbols-outlined icon">event</span>Events
        </div>
        <div id="conversationsNav" class="nav-item admin-only" data-tab="conversations" tabindex="0">
          <span class="material-symbols-outlined icon">chat_bubble</span>Conversations
        </div>
        <div class="nav-item" data-tab="clubs" tabindex="0">
          <span class="material-symbols-outlined icon">groups</span>Clubs
        </div>
        <div class="nav-item" data-tab="reports" tabindex="0">
          <span class="material-symbols-outlined icon">analytics</span>Reports
        </div>
        <div class="nav-item" data-tab="profile" tabindex="0">
          <span class="material-symbols-outlined icon">person</span>Profile
        </div>
        <div id="adminNav" class="nav-item admin-only" data-tab="admin" tabindex="0">
          <span class="material-symbols-outlined icon">admin_panel_settings</span>Admin Panel
        </div>
        <!-- Club tabs will be dynamically added here -->
      </nav>
      
      <div class="profile-card">
        <div class="profile-header">
          <div class="profile-avatar" id="sideProfileInitials">GU</div>
          <div class="profile-info">
            <div class="profile-name" id="sideName">Guest User</div>
            <div class="profile-role" id="sideRole">Not signed in</div>
          </div>
        </div>
        <div class="profile-stats">
          <div class="profile-stat">
            <div class="profile-stat-value" id="projectsCount">0</div>
            <div class="profile-stat-label">Projects</div>
          </div>
          <div class="profile-stat">
            <div class="profile-stat-value" id="clubsCount">0</div>
            <div class="profile-stat-label">Clubs</div>
          </div>
          <div class="profile-stat">
            <div class="profile-stat-value" id="assignmentsCount">0</div>
            <div class="profile-stat-label">Assignments</div>
          </div>
          <div class="profile-stat">
            <div class="profile-stat-value" id="streakCount">0</div>
            <div class="profile-stat-label">Day Streak</div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="sidebar-footer">
      <div style="display: flex; gap: 8px; margin-bottom: 12px;">
        <button id="sidebarLogout" class="btn ghost" style="flex:1; display:none">Logout</button>
        <button id="openLogin" class="btn primary" style="flex:1">Login</button>
      </div>
      <div style="text-align: center; font-size: 11px; color: var(--muted);">
        <div>Student Portal v2.0</div>
        <div id="lastSync">Last sync: --:--</div>
      </div>
    </div>
  </aside>

  <!-- Enhanced Main Content -->
  <main class="main">
    <!-- Enhanced Topbar -->
    <div class="topbar">
      <div class="search-container">
        <div class="search">
          <span class="material-symbols-outlined" style="color:var(--muted)">search</span>
          <input id="globalSearch" placeholder="Search projects, clubs, assignments, users..." aria-label="Search">
        </div>
      </div>
      <div class="top-actions">
        <div class="language-switcher">
          <button class="language-btn" id="languageBtn">
            <span class="material-symbols-outlined">language</span>
            <span>English</span>
            <span class="material-symbols-outlined" style="font-size:16px">arrow_drop_down</span>
          </button>
          <div class="language-dropdown" id="languageDropdown">
            <div class="language-option active" data-lang="en">
              <span>ðŸ‡¬ðŸ‡§</span>
              <span>English</span>
            </div>
            <div class="language-option" data-lang="fr">
              <span>ðŸ‡«ðŸ‡·</span>
              <span>FranÃ§ais</span>
            </div>
            <div class="language-option" data-lang="ar">
              <span>ðŸ‡²ðŸ‡¦</span>
              <span>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
            </div>
          </div>
        </div>
        <div class="notification-bell" id="notificationBell" tabindex="0" aria-label="Notifications">
          <span class="material-symbols-outlined">notifications</span>
          <span class="notification-badge" id="notificationCount" style="display:none">0</span>
        </div>
        <div class="welcome-container">
          <div class="welcome-text" id="welcomeText">Welcome</div>
          <div class="welcome-sub" id="welcomeSub">Please sign in</div>
        </div>
      </div>
    </div>

    <!-- Enhanced Dashboard -->
    <section id="dashboard" class="card">
      <div class="card-header">
        <h2 class="card-title">Dashboard Overview</h2>
        <div class="card-actions">
          <button class="btn btn-icon ghost" id="refreshDashboard" title="Refresh">
            <span class="material-symbols-outlined">refresh</span>
          </button>
        </div>
      </div>
      
      <div class="dashboard-grid">
        <div class="dashboard-widget">
          <div class="widget-header">
            <div class="widget-icon">
              <span class="material-symbols-outlined">work</span>
            </div>
            <div class="widget-title">My Projects</div>
          </div>
          <div class="widget-value" id="widgetProjects">0</div>
          <div class="widget-trend">
            <span>Active projects</span>
          </div>
        </div>
        
        <div class="dashboard-widget">
          <div class="widget-header">
            <div class="widget-icon">
              <span class="material-symbols-outlined">assignment</span>
            </div>
            <div class="widget-title">Pending Assignments</div>
          </div>
          <div class="widget-value" id="widgetAssignments">0</div>
          <div class="widget-trend">
            <span>To be completed</span>
          </div>
        </div>
        
        <div class="dashboard-widget">
          <div class="widget-header">
            <div class="widget-icon">
              <span class="material-symbols-outlined">groups</span>
            </div>
            <div class="widget-title">Clubs Joined</div>
          </div>
          <div class="widget-value" id="widgetClubs">0</div>
          <div class="widget-trend">
            <span>Active memberships</span>
          </div>
        </div>
        
        <div class="dashboard-widget">
          <div class="widget-header">
            <div class="widget-icon">
              <span class="material-symbols-outlined">trending_up</span>
            </div>
            <div class="widget-title">Activity</div>
          </div>
          <div class="widget-value" id="widgetActivity">0</div>
          <div class="widget-trend">
            <span>This week</span>
          </div>
        </div>
      </div>
      
      <div style="margin-top: 24px;">
        <h3 style="margin-bottom: 16px;">Recent Activity</h3>
        <div id="recentActivity">No recent activity</div>
      </div>
    </section>
    
    <!-- Enhanced Projects Section -->
    <section id="projects" class="card" style="display:none">
      <div class="card-header">
        <h2 class="card-title">Projects</h2>
        <div class="card-actions">
          <button id="createProjectBtn" class="btn primary">
            <span class="material-symbols-outlined" style="font-size:18px">add</span> Create Project
          </button>
        </div>
      </div>
      <div id="projectsList">No projects yet. Create one to get started!</div>
    </section>
    
    <!-- Enhanced Assignments Section -->
    <section id="assignments" class="card" style="display:none">
      <div class="card-header">
        <h2 class="card-title">Assignments</h2>
        <div class="card-actions">
          <button id="submitAssignmentBtn" class="btn primary">
            <span class="material-symbols-outlined" style="font-size:18px">upload</span> Submit Assignment
          </button>
        </div>
      </div>
      <div id="assignmentsList">No assignments yet</div>
    </section>
    
    <!-- Enhanced Events Section -->
    <section id="events" class="card" style="display:none">
      <div class="card-header">
        <h2 class="card-title">Upcoming Events</h2>
        <div class="card-actions">
          <button id="createEventBtn" class="btn primary admin-only">
            <span class="material-symbols-outlined" style="font-size:18px">add</span> Create Event
          </button>
        </div>
      </div>
      <div id="eventsList">No upcoming events</div>
    </section>
    
    <!-- Enhanced Conversations Section -->
    <section id="conversations" class="card admin-only" style="display:none">
      <div class="card-header">
        <h2 class="card-title">Conversations</h2>
        <div class="card-actions">
          <button id="newConversationBtn" class="btn primary">
            <span class="material-symbols-outlined" style="font-size:18px">add_comment</span> New Conversation
          </button>
        </div>
      </div>
      <div class="chat-area">
        <div class="chat-window">
          <div class="chat-messages" id="chatWindow"></div>
        </div>
        <div class="chat-input-container">
          <input id="chatInput" placeholder="Type your message..." class="chat-input" aria-label="Message input">
          <button class="btn primary" id="sendBtn">
            <span class="material-symbols-outlined">send</span> Send
          </button>
        </div>
      </div>
    </section>
    
    <!-- Enhanced Clubs Section -->
    <section id="clubs" class="card" style="display:none">
      <div class="card-header">
        <h2 class="card-title">Clubs & Organizations</h2>
        <div class="card-actions">
          <button id="createClubBtn" class="btn primary admin-only">
            <span class="material-symbols-outlined" style="font-size:18px">add</span> Create Club
          </button>
        </div>
      </div>
      <div id="clubsList">Loading clubs...</div>
    </section>
    
    <!-- Enhanced Reports Section -->
    <section id="reports" class="card" style="display:none">
      <div class="card-header">
        <h2 class="card-title">Reports & Analytics</h2>
        <div class="card-actions">
          <button id="exportReportBtn" class="btn success">
            <span class="material-symbols-outlined" style="font-size:18px">download</span> Export
          </button>
        </div>
      </div>
      <div id="reportsContent">No reports available</div>
    </section>
    
    <!-- Enhanced Profile Section -->
    <section id="profile" class="card" style="display:none">
      <div class="card-header">
        <h2 class="card-title">My Profile</h2>
        <div class="card-actions">
          <button id="changePasswordBtn" class="btn ghost">Change Password</button>
          <button id="saveProfileBtn" class="btn success">Save Profile</button>
        </div>
      </div>
      <div class="profile-form">
        <div class="form-group" style="display:flex; gap:24px; align-items:flex-start;">
          <div class="profile-avatar-upload">
            <img id="profilePic" src="" class="profile-avatar" alt="Profile Picture" style="display:none">
            <div class="profile-avatar" id="profileAvatarFallback">GU</div>
            <div class="profile-avatar-overlay" id="uploadAvatarOverlay">
              <span class="material-symbols-outlined">photo_camera</span>
            </div>
          </div>
          <div style="flex:1">
            <input type="file" id="profilePicInput" class="sr-only" accept="image/*">
            <div class="form-group">
              <label class="form-label" for="profileName">Full Name</label>
              <input type="text" id="profileName" class="form-control" placeholder="Your Full Name">
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="profileEmail">Email</label>
                <input type="email" id="profileEmail" class="form-control" placeholder="your.email@example.com" disabled>
              </div>
              <div class="form-group">
                <label class="form-label" for="profileGrade">Grade</label>
                <select id="profileGrade" class="form-control form-select">
                  <option value="">Select Grade</option>
                  <option value="TC">TC</option>
                  <option value="1BAC">1BAC</option>
                  <option value="2BAC">2BAC</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="profileBio">Bio</label>
          <textarea id="profileBio" class="form-control form-textarea" placeholder="Tell us about yourself..." rows="4"></textarea>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="profilePhone">Phone Number</label>
            <input type="tel" id="profilePhone" class="form-control" placeholder="+212 6XX-XXXXXX">
          </div>
          <div class="form-group">
            <label class="form-label" for="profileLocation">Location</label>
            <input type="text" id="profileLocation" class="form-control" placeholder="City, Country">
          </div>
        </div>
      </div>
    </section>
    
    <!-- Enhanced Admin Panel -->
    <section id="admin" class="card admin-only" style="display:none">
      <div class="card-header">
        <h2 class="card-title">Admin Panel</h2>
        <div class="card-actions">
          <button id="systemHealthBtn" class="btn ghost">System Health</button>
        </div>
      </div>
      <div class="admin-controls">
        <button id="manageUsersBtn" class="btn primary">Manage Users</button>
        <button id="systemStatsBtn" class="btn">System Stats</button>
        <button id="manageRolesBtn" class="btn">Manage Roles</button>
        <button id="settingsBtn" class="btn">Settings</button>
      </div>
      <div id="adminContent"></div>
    </section>
    
    <!-- Club sections will be dynamically added here -->
  </main>
</div>

<!-- Enhanced Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Enhanced Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-content">
    <div class="loading-spinner"></div>
    <div id="loadingText">Loading...</div>
  </div>
</div>

<!-- Enhanced Auth Modal -->
<div class="modal-overlay" id="authModal">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">Welcome to BNI Yekhlef Student Portal</h3>
      <button class="modal-close" id="closeAuthModal">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label" for="modalEmail">Email</label>
        <input type="email" id="modalEmail" class="form-control" placeholder="student@bniyekhlef.edu">
        <div class="form-error" id="modalEmailError"></div>
      </div>
      <div class="form-group">
        <label class="form-label" for="modalPass">Password</label>
        <input type="password" id="modalPass" class="form-control" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        <div class="form-error" id="modalPassError"></div>
      </div>
      <div class="form-group" id="registerFields" style="display:none;">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="modalFirstName">First Name</label>
            <input type="text" id="modalFirstName" class="form-control" placeholder="John">
          </div>
          <div class="form-group">
            <label class="form-label" for="modalLastName">Last Name</label>
            <input type="text" id="modalLastName" class="form-control" placeholder="Doe">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label" for="modalGrade">Grade</label>
          <select id="modalGrade" class="form-control form-select">
            <option value="">Select Grade</option>
            <option value="TC">TC</option>
            <option value="1BAC">1BAC</option>
            <option value="2BAC">2BAC</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <div class="form-check" style="display:flex; align-items:center; gap:8px;">
          <input type="checkbox" id="rememberMe" class="form-check-input">
          <label for="rememberMe" style="font-size:14px;">Remember me</label>
        </div>
      </div>
      <div class="form-group">
        <button id="toggleRegister" class="btn ghost sm" style="font-size:13px;">Don't have an account? Register</button>
        <button id="forgotPassword" class="btn ghost sm" style="font-size:13px;">Forgot password?</button>
      </div>
    </div>
    <div class="modal-footer">
      <button id="modalCancel" class="btn ghost">Cancel</button>
      <button id="modalAction" class="btn primary">Login</button>
    </div>
  </div>
</div>

<!-- Enhanced Club Creation Modal -->
<div class="modal-overlay" id="createClubModal">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">Create New Club</h3>
      <button class="modal-close" id="closeClubModal">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label" for="clubName">Club Name *</label>
        <input type="text" id="clubName" class="form-control" placeholder="e.g., Science Club">
        <div class="form-error" id="clubNameError"></div>
      </div>
      <div class="form-group">
        <label class="form-label" for="clubAbbreviation">Abbreviation *</label>
        <input type="text" id="clubAbbreviation" class="form-control" placeholder="e.g., SC" maxlength="10">
        <div class="form-error" id="clubAbbreviationError"></div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="clubLeader1">Primary Leader *</label>
          <input type="text" id="clubLeader1" class="form-control" placeholder="Full name">
        </div>
        <div class="form-group">
          <label class="form-label" for="clubLeader2">Secondary Leader</label>
          <input type="text" id="clubLeader2" class="form-control" placeholder="Optional">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label" for="clubDescription">Description *</label>
        <textarea id="clubDescription" class="form-control form-textarea" placeholder="Describe the club's purpose and activities..."></textarea>
        <div class="form-error" id="clubDescriptionError"></div>
      </div>
      <div class="form-group">
        <label class="form-label" for="clubCategory">Category</label>
        <select id="clubCategory" class="form-control form-select">
          <option value="academic">Academic</option>
          <option value="sports">Sports</option>
          <option value="arts">Arts & Culture</option>
          <option value="technology">Technology</option>
          <option value="social">Social & Community</option>
          <option value="other">Other</option>
        </select>
      </div>
    </div>
    <div class="modal-footer">
      <button id="cancelClubBtn" class="btn ghost">Cancel</button>
      <button id="saveClubBtn" class="btn success">Create Club</button>
    </div>
  </div>
</div>

<!-- Enhanced Project Creation Modal -->
<div class="modal-overlay" id="createProjectModal">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">Create New Project</h3>
      <button class="modal-close" id="closeProjectModal">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label" for="projectTitle">Project Title *</label>
        <input type="text" id="projectTitle" class="form-control" placeholder="e.g., Science Fair Project">
        <div class="form-error" id="projectTitleError"></div>
      </div>
      <div class="form-group">
        <label class="form-label" for="projectDescription">Description *</label>
        <textarea id="projectDescription" class="form-control form-textarea" placeholder="Describe your project..."></textarea>
        <div class="form-error" id="projectDescriptionError"></div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="projectDeadline">Deadline</label>
          <input type="date" id="projectDeadline" class="form-control">
        </div>
        <div class="form-group">
          <label class="form-label" for="projectStatus">Status</label>
          <select id="projectStatus" class="form-control form-select">
            <option value="planning">Planning</option>
            <option value="in-progress">In Progress</option>
            <option value="review">Under Review</option>
            <option value="completed">Completed</option>
          </select>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button id="cancelProjectBtn" class="btn ghost">Cancel</button>
      <button id="saveProjectBtn" class="btn success">Create Project</button>
    </div>
  </div>
</div>

<!-- Enhanced Role Management Modal -->
<div class="modal-overlay" id="roleModal">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">Manage User Role</h3>
      <button class="modal-close" id="closeRoleModal">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>
    <div class="modal-body">
      <div id="roleUserInfo" style="margin-bottom: 24px; padding:16px; background:var(--surface-secondary); border-radius:var(--radius-sm);"></div>
      <div style="display:grid; grid-template-columns:repeat(2,1fr); gap:12px;">
        <label style="display:block; padding:16px; border:2px solid #e2e8f0; border-radius:var(--radius-sm); cursor:pointer; transition:var(--transition);" class="role-option">
          <input type="radio" name="userRole" value="student" style="display:none;">
          <div style="text-align:center;">
            <span class="material-symbols-outlined" style="font-size:32px; margin-bottom:8px;">school</span>
            <div style="font-weight:600;">Student</div>
            <div style="font-size:12px; color:var(--muted);">Regular user</div>
          </div>
        </label>
        <label style="display:block; padding:16px; border:2px solid #e2e8f0; border-radius:var(--radius-sm); cursor:pointer; transition:var(--transition);" class="role-option">
          <input type="radio" name="userRole" value="leader" style="display:none;">
          <div style="text-align:center;">
            <span class="material-symbols-outlined" style="font-size:32px; margin-bottom:8px;">leaderboard</span>
            <div style="font-weight:600;">Leader</div>
            <div style="font-size:12px; color:var(--muted);">Club leadership</div>
          </div>
        </label>
        <label style="display:block; padding:16px; border:2px solid #e2e8f0; border-radius:var(--radius-sm); cursor:pointer; transition:var(--transition);" class="role-option">
          <input type="radio" name="userRole" value="admin" style="display:none;">
          <div style="text-align:center;">
            <span class="material-symbols-outlined" style="font-size:32px; margin-bottom:8px;">admin_panel_settings</span>
            <div style="font-weight:600;">Admin</div>
            <div style="font-size:12px; color:var(--muted);">Full system access</div>
          </div>
        </label>
      </div>
      <div class="form-group" style="margin-top:16px;">
        <label class="form-label" for="roleNotes">Notes (Optional)</label>
        <textarea id="roleNotes" class="form-control form-textarea" placeholder="Add notes about this role change..." rows="2"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button id="cancelRoleBtn" class="btn ghost">Cancel</button>
      <button id="saveRoleBtn" class="btn success">Save Changes</button>
    </div>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

<script>
// =============================================
// BNI YEKHELF HIGHSCHOOL - STUDENT PORTAL
// =============================================

// --- Firebase Configuration ---
const firebaseConfig = {
  apiKey: "AIzaSyBcvybNF9Hn89jb2zRQxknb6l0uMeiS-EM",
  authDomain: "school-bni-yekhlef-id.firebaseapp.com",
  projectId: "bniyekhlef-high-school",
  storageBucket: "school-bni-yekhlef-id",
  messagingSenderId: "893030570286",
  appId: "1:893030570286:web:bec5df8427b532f5e202bf",
  measurementId: "G-4V7JRRR48W"
};

// --- Initialize Firebase ---
try {
  firebase.initializeApp(firebaseConfig);
} catch (err) {
  console.error('Firebase initialization error:', err);
}

const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

// Enable offline persistence
db.enablePersistence().catch((err) => {
  console.error('Offline persistence failed:', err);
});

// --- State Management ---
const State = {
  currentUser: null,
  userData: null,
  userRole: 'guest',
  activeTab: 'dashboard',
  clubTabs: new Map(),
  isOnline: navigator.onLine,
  currentLanguage: 'en'
};

// --- Language Translations ---
const translations = {
  en: {
    welcome: "Welcome",
    pleaseSignIn: "Please sign in",
    dashboard: "Dashboard",
    projects: "Projects",
    assignments: "Assignments",
    events: "Events",
    conversations: "Conversations",
    clubs: "Clubs",
    reports: "Reports",
    profile: "Profile",
    adminPanel: "Admin Panel",
    logout: "Logout",
    login: "Login",
    searchPlaceholder: "Search projects, clubs, assignments...",
    noProjects: "No projects yet. Create one to get started!",
    noAssignments: "No assignments yet",
    noEvents: "No upcoming events",
    loading: "Loading...",
    save: "Save",
    cancel: "Cancel",
    create: "Create",
    update: "Update",
    delete: "Delete",
    join: "Join",
    leave: "Leave",
    members: "Members",
    leader: "Leader",
    student: "Student",
    admin: "Administrator"
  },
  fr: {
    welcome: "Bienvenue",
    pleaseSignIn: "Veuillez vous connecter",
    dashboard: "Tableau de bord",
    projects: "Projets",
    assignments: "Devoirs",
    events: "Ã‰vÃ©nements",
    conversations: "Conversations",
    clubs: "Clubs",
    reports: "Rapports",
    profile: "Profil",
    adminPanel: "Panneau d'administration",
    logout: "DÃ©connexion",
    login: "Connexion",
    searchPlaceholder: "Rechercher projets, clubs, devoirs...",
    noProjects: "Aucun projet pour le moment. CrÃ©ez-en un pour commencer!",
    noAssignments: "Aucun devoir pour le moment",
    noEvents: "Aucun Ã©vÃ©nement Ã  venir",
    loading: "Chargement...",
    save: "Enregistrer",
    cancel: "Annuler",
    create: "CrÃ©er",
    update: "Mettre Ã  jour",
    delete: "Supprimer",
    join: "Rejoindre",
    leave: "Quitter",
    members: "Membres",
    leader: "Responsable",
    student: "Ã‰tudiant",
    admin: "Administrateur"
  },
  ar: {
    welcome: "Ù…Ø±Ø­Ø¨Ø§Ù‹",
    pleaseSignIn: "ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„",
    dashboard: "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…",
    projects: "Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹",
    assignments: "Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª",
    events: "Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª",
    conversations: "Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª",
    clubs: "Ø§Ù„Ø£Ù†Ø¯ÙŠØ©",
    reports: "Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±",
    profile: "Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ",
    adminPanel: "Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©",
    logout: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬",
    login: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„",
    searchPlaceholder: "Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ØŒ Ø§Ù„Ø£Ù†Ø¯ÙŠØ©ØŒ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª...",
    noProjects: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¨Ø¹Ø¯. Ø£Ù†Ø´Ø¦ Ù…Ø´Ø±ÙˆØ¹Ø§Ù‹ Ù„ØªØ¨Ø¯Ø£!",
    noAssignments: "Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ§Ø¬Ø¨Ø§Øª Ø¨Ø¹Ø¯",
    noEvents: "Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¹Ø§Ù„ÙŠØ§Øª Ù‚Ø§Ø¯Ù…Ø©",
    loading: "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...",
    save: "Ø­ÙØ¸",
    cancel: "Ø¥Ù„ØºØ§Ø¡",
    create: "Ø¥Ù†Ø´Ø§Ø¡",
    update: "ØªØ­Ø¯ÙŠØ«",
    delete: "Ø­Ø°Ù",
    join: "Ø§Ù†Ø¶Ù…",
    leave: "ØºØ§Ø¯Ø±",
    members: "Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡",
    leader: "Ù‚Ø§Ø¦Ø¯",
    student: "Ø·Ø§Ù„Ø¨",
    admin: "Ù…Ø¯ÙŠØ±"
  }
};

// --- Toast System ---
class Toast {
  static show(message, type = 'info', duration = 4000) {
    const container = document.getElementById('toastContainer');
    if (!container) return;
    
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.innerHTML = `
      <span class="material-symbols-outlined toast-icon">
        ${this.getIconForType(type)}
      </span>
      <div class="toast-content">
        <div class="toast-title">${this.getTitleForType(type)}</div>
        <div class="toast-message">${message}</div>
      </div>
      <button class="toast-close">
        <span class="material-symbols-outlined">close</span>
      </button>
    `;
    
    container.appendChild(toast);
    
    setTimeout(() => toast.classList.add('show'), 10);
    
    const autoRemove = setTimeout(() => this.remove(toast), duration);
    
    const closeBtn = toast.querySelector('.toast-close');
    closeBtn.onclick = () => this.remove(toast);
    
    toast._autoRemove = autoRemove;
  }
  
  static remove(toast) {
    if (toast._autoRemove) clearTimeout(toast._autoRemove);
    toast.classList.remove('show');
    setTimeout(() => toast.remove(), 300);
  }
  
  static getIconForType(type) {
    const icons = {
      success: 'check_circle',
      error: 'error',
      warning: 'warning',
      info: 'info'
    };
    return icons[type] || 'info';
  }
  
  static getTitleForType(type) {
    const titles = {
      success: 'Success',
      error: 'Error',
      warning: 'Warning',
      info: 'Info'
    };
    return titles[type] || 'Info';
  }
}

// --- Modal System ---
class Modal {
  static show(id) {
    const modal = document.getElementById(id);
    if (modal) {
      modal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }
  }
  
  static hide(id) {
    const modal = document.getElementById(id);
    if (modal) {
      modal.style.display = 'none';
      document.body.style.overflow = 'auto';
    }
  }
  
  static closeAll() {
    document.querySelectorAll('.modal-overlay').forEach(modal => {
      modal.style.display = 'none';
    });
    document.body.style.overflow = 'auto';
  }
}

// --- Loading System ---
class Loading {
  static show(text = 'Loading...') {
    const overlay = document.getElementById('loadingOverlay');
    const textEl = document.getElementById('loadingText');
    if (overlay && textEl) {
      textEl.textContent = text;
      overlay.classList.add('show');
    }
  }
  
  static hide() {
    const overlay = document.getElementById('loadingOverlay');
    if (overlay) {
      overlay.classList.remove('show');
    }
  }
}

// --- Form Validation ---
class Validator {
  static validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
  }
  
  static validatePassword(password) {
    return password.length >= 6;
  }
  
  static validateRequired(value) {
    return value && value.trim().length > 0;
  }
}

// --- Authentication System ---
class AuthManager {
  static async login(email, password, rememberMe = false) {
    try {
      Loading.show('Signing in...');
      
      // Set persistence
      const persistence = rememberMe ? 
        firebase.auth.Auth.Persistence.LOCAL : 
        firebase.auth.Auth.Persistence.SESSION;
      
      await auth.setPersistence(persistence);
      const userCredential = await auth.signInWithEmailAndPassword(email, password);
      
      Toast.show('Logged in successfully!', 'success');
      return userCredential;
    } catch (error) {
      let errorMessage = 'Login failed';
      switch(error.code) {
        case 'auth/user-not-found':
          errorMessage = 'User not found';
          break;
        case 'auth/wrong-password':
          errorMessage = 'Invalid password';
          break;
        case 'auth/invalid-email':
          errorMessage = 'Invalid email address';
          break;
        case 'auth/user-disabled':
          errorMessage = 'Account disabled';
          break;
        case 'auth/too-many-requests':
          errorMessage = 'Too many attempts. Try again later';
          break;
      }
      Toast.show(errorMessage, 'error');
      throw error;
    } finally {
      Loading.hide();
    }
  }
  
  static async register(email, password, userData) {
    try {
      Loading.show('Creating account...');
      
      const userCredential = await auth.createUserWithEmailAndPassword(email, password);
      
      // Create user profile in Firestore
      const profileData = {
        uid: userCredential.user.uid,
        email: email,
        name: `${userData.firstName} ${userData.lastName}`,
        firstName: userData.firstName,
        lastName: userData.lastName,
        grade: userData.grade,
        role: 'student',
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
        status: 'active'
      };
      
      await db.collection('users').doc(userCredential.user.uid).set(profileData);
      
      // Create user stats document
      await db.collection('userStats').doc(userCredential.user.uid).set({
        uid: userCredential.user.uid,
        projects: 0,
        clubs: 0,
        assignments: 0,
        streak: 0,
        lastActive: firebase.firestore.FieldValue.serverTimestamp(),
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      
      Toast.show('Account created successfully!', 'success');
      return userCredential;
    } catch (error) {
      let errorMessage = 'Registration failed';
      switch(error.code) {
        case 'auth/email-already-in-use':
          errorMessage = 'Email already in use';
          break;
        case 'auth/invalid-email':
          errorMessage = 'Invalid email address';
          break;
        case 'auth/operation-not-allowed':
          errorMessage = 'Registration is not allowed';
          break;
        case 'auth/weak-password':
          errorMessage = 'Password is too weak';
          break;
      }
      Toast.show(errorMessage, 'error');
      throw error;
    } finally {
      Loading.hide();
    }
  }
  
  static async resetPassword(email) {
    try {
      await auth.sendPasswordResetEmail(email);
      Toast.show('Password reset email sent', 'success');
    } catch (error) {
      Toast.show('Failed to send reset email', 'error');
    }
  }
}

// --- User Management ---
class UserManager {
  static async getUserData(uid) {
    try {
      const doc = await db.collection('users').doc(uid).get();
      if (doc.exists) {
        return doc.data();
      }
      return null;
    } catch (error) {
      console.error('Error getting user data:', error);
      return null;
    }
  }
  
  static async updateUserProfile(uid, updates) {
    try {
      await db.collection('users').doc(uid).update({
        ...updates,
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      return true;
    } catch (error) {
      console.error('Error updating profile:', error);
      return false;
    }
  }
  
  static async updateUserRole(uid, newRole) {
    try {
      await db.collection('users').doc(uid).update({
        role: newRole,
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      return true;
    } catch (error) {
      console.error('Error updating role:', error);
      return false;
    }
  }
}

// --- Club Management ---
class ClubManager {
  static async createClub(clubData) {
    try {
      Loading.show('Creating club...');
      
      const clubDoc = {
        name: clubData.name,
        abbreviation: clubData.abbreviation,
        description: clubData.description,
        category: clubData.category,
        leader1: clubData.leader1,
        leader2: clubData.leader2 || '',
        createdBy: State.currentUser.uid,
        creatorEmail: State.currentUser.email,
        members: [State.currentUser.uid],
        memberCount: 1,
        funds: 0,
        projects: [],
        events: [],
        status: 'active',
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      };
      
      const result = await db.collection('clubs').add(clubDoc);
      
      // Update user stats
      await db.collection('userStats').doc(State.currentUser.uid).update({
        clubs: firebase.firestore.FieldValue.increment(1)
      });
      
      Toast.show('Club created successfully!', 'success');
      return result.id;
    } catch (error) {
      Toast.show('Failed to create club', 'error');
      throw error;
    } finally {
      Loading.hide();
    }
  }
  
  static async joinClub(clubId) {
    try {
      const clubRef = db.collection('clubs').doc(clubId);
      const clubDoc = await clubRef.get();
      
      if (!clubDoc.exists) {
        Toast.show('Club not found', 'error');
        return;
      }
      
      const clubData = clubDoc.data();
      if (clubData.members.includes(State.currentUser.uid)) {
        Toast.show('You are already a member', 'info');
        return;
      }
      
      await clubRef.update({
        members: firebase.firestore.FieldValue.arrayUnion(State.currentUser.uid),
        memberCount: clubData.members.length + 1,
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      
      // Update user stats
      await db.collection('userStats').doc(State.currentUser.uid).update({
        clubs: firebase.firestore.FieldValue.increment(1)
      });
      
      Toast.show('Successfully joined the club!', 'success');
      return true;
    } catch (error) {
      Toast.show('Failed to join club', 'error');
      return false;
    }
  }
  
  static async loadClubs() {
    try {
      const snapshot = await db.collection('clubs').get();
      return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    } catch (error) {
      console.error('Error loading clubs:', error);
      return [];
    }
  }
}

// --- Project Management ---
class ProjectManager {
  static async createProject(projectData) {
    try {
      Loading.show('Creating project...');
      
      const projectDoc = {
        title: projectData.title,
        description: projectData.description,
        status: projectData.status || 'planning',
        deadline: projectData.deadline || null,
        createdBy: State.currentUser.uid,
        creatorEmail: State.currentUser.email,
        creatorName: State.userData.name,
        team: [State.currentUser.uid],
        progress: 0,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      };
      
      const result = await db.collection('projects').add(projectDoc);
      
      // Update user stats
      await db.collection('userStats').doc(State.currentUser.uid).update({
        projects: firebase.firestore.FieldValue.increment(1)
      });
      
      Toast.show('Project created successfully!', 'success');
      return result.id;
    } catch (error) {
      Toast.show('Failed to create project', 'error');
      throw error;
    } finally {
      Loading.hide();
    }
  }
  
  static async loadProjects() {
    try {
      const snapshot = await db.collection('projects')
        .where('createdBy', '==', State.currentUser.uid)
        .get();
      
      return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    } catch (error) {
      console.error('Error loading projects:', error);
      return [];
    }
  }
}

// --- Dashboard System ---
class DashboardManager {
  static async loadDashboardData() {
    try {
      if (!State.currentUser) return;
      
      const [projects, clubs, assignments] = await Promise.all([
        ProjectManager.loadProjects(),
        this.getUserClubs(),
        this.getUserAssignments()
      ]);
      
      // Update dashboard widgets
      this.updateWidgets(projects.length, clubs.length, assignments.pending);
      
      // Update profile stats
      this.updateProfileStats(projects.length, clubs.length, assignments.pending);
      
      // Update recent activity
      this.updateRecentActivity([...projects, ...clubs]);
    } catch (error) {
      console.error('Error loading dashboard data:', error);
    }
  }
  
  static async getUserClubs() {
    try {
      const snapshot = await db.collection('clubs')
        .where('members', 'array-contains', State.currentUser.uid)
        .get();
      
      return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    } catch (error) {
      console.error('Error loading user clubs:', error);
      return [];
    }
  }
  
  static async getUserAssignments() {
    // Simplified - implement based on your needs
    return { pending: 0, all: [] };
  }
  
  static updateWidgets(projects, clubs, assignments) {
    document.getElementById('widgetProjects').textContent = projects;
    document.getElementById('widgetClubs').textContent = clubs;
    document.getElementById('widgetAssignments').textContent = assignments;
    document.getElementById('widgetActivity').textContent = projects + clubs;
  }
  
  static updateProfileStats(projects, clubs, assignments) {
    document.getElementById('projectsCount').textContent = projects;
    document.getElementById('clubsCount').textContent = clubs;
    document.getElementById('assignmentsCount').textContent = assignments;
    document.getElementById('streakCount').textContent = '0';
  }
  
  static updateRecentActivity(items) {
    const container = document.getElementById('recentActivity');
    if (!container) return;
    
    if (items.length === 0) {
      container.innerHTML = '<div class="list-item">No recent activity</div>';
      return;
    }
    
    // Sort by creation date
    items.sort((a, b) => {
      const dateA = a.createdAt?.toDate() || new Date(0);
      const dateB = b.createdAt?.toDate() || new Date(0);
      return dateB - dateA;
    });
    
    const recentItems = items.slice(0, 5);
    
    container.innerHTML = recentItems.map(item => `
      <div class="list-item">
        <div class="list-item-content">
          <div class="list-item-title">${item.title || item.name}</div>
          <div class="list-item-subtitle">${item.description || ''}</div>
          <div class="list-item-meta">
            <span>${item.createdAt ? item.createdAt.toDate().toLocaleDateString() : 'Recent'}</span>
            <span>${item.status ? `Status: ${item.status}` : ''}</span>
          </div>
        </div>
      </div>
    `).join('');
  }
}

// --- Language System ---
class LanguageManager {
  static setLanguage(lang) {
    if (!translations[lang]) return;
    
    State.currentLanguage = lang;
    localStorage.setItem('portal_language', lang);
    
    // Update language button
    const langBtn = document.getElementById('languageBtn');
    if (langBtn) {
      const langText = langBtn.querySelector('span:nth-child(2)');
      if (langText) {
        langText.textContent = lang === 'en' ? 'English' : 
                               lang === 'fr' ? 'FranÃ§ais' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
      }
    }
    
    // Update all translations
    this.updateTranslations();
  }
  
  static updateTranslations() {
    const t = translations[State.currentLanguage];
    
    // Update navigation
    document.querySelectorAll('.nav-item').forEach((item, index) => {
      const textSpan = item.querySelector('.nav-item-text');
      if (textSpan) {
        const texts = ['dashboard', 'projects', 'assignments', 'events', 'conversations', 'clubs', 'reports', 'profile', 'adminPanel'];
        if (texts[index]) {
          textSpan.textContent = t[texts[index]];
        }
      }
    });
    
    // Update buttons
    const elements = {
      'openLogin': t.login,
      'sidebarLogout': t.logout,
      'saveProfileBtn': t.save,
      'modalAction': t.login,
      'cancelClubBtn': t.cancel,
      'saveClubBtn': t.create,
      'cancelProjectBtn': t.cancel,
      'saveProjectBtn': t.create,
      'cancelRoleBtn': t.cancel,
      'saveRoleBtn': t.save
    };
    
    Object.keys(elements).forEach(id => {
      const el = document.getElementById(id);
      if (el) el.textContent = elements[id];
    });
    
    // Update placeholders
    const searchInput = document.getElementById('globalSearch');
    if (searchInput) searchInput.placeholder = t.searchPlaceholder;
    
    const chatInput = document.getElementById('chatInput');
    if (chatInput) chatInput.placeholder = t.searchPlaceholder;
  }
  
  static init() {
    // Load saved language or default to English
    const savedLang = localStorage.getItem('portal_language') || 'en';
    this.setLanguage(savedLang);
  }
}

// --- UI Initialization ---
function initUI() {
  // Sidebar navigation
  document.querySelectorAll('.nav-item').forEach(item => {
    const text = item.textContent;
    const icon = item.querySelector('.icon');
    item.innerHTML = '';
    if (icon) item.appendChild(icon);
    const textSpan = document.createElement('span');
    textSpan.className = 'nav-item-text';
    textSpan.textContent = text.trim();
    item.appendChild(textSpan);
    
    item.addEventListener('click', handleNavigation);
  });
  
  // Auth modal
  document.getElementById('openLogin').addEventListener('click', () => Modal.show('authModal'));
  document.getElementById('closeAuthModal').addEventListener('click', () => Modal.hide('authModal'));
  document.getElementById('modalCancel').addEventListener('click', () => Modal.hide('authModal'));
  document.getElementById('toggleRegister').addEventListener('click', toggleRegisterMode);
  document.getElementById('forgotPassword').addEventListener('click', handleForgotPassword);
  document.getElementById('modalAction').addEventListener('click', handleAuthAction);
  
  // Club modal
  document.getElementById('createClubBtn').addEventListener('click', () => Modal.show('createClubModal'));
  document.getElementById('closeClubModal').addEventListener('click', () => Modal.hide('createClubModal'));
  document.getElementById('cancelClubBtn').addEventListener('click', () => Modal.hide('createClubModal'));
  document.getElementById('saveClubBtn').addEventListener('click', handleCreateClub);
  
  // Project modal
  document.getElementById('createProjectBtn').addEventListener('click', () => Modal.show('createProjectModal'));
  document.getElementById('closeProjectModal').addEventListener('click', () => Modal.hide('createProjectModal'));
  document.getElementById('cancelProjectBtn').addEventListener('click', () => Modal.hide('createProjectModal'));
  document.getElementById('saveProjectBtn').addEventListener('click', handleCreateProject);
  
  // Role modal
  document.getElementById('closeRoleModal').addEventListener('click', () => Modal.hide('roleModal'));
  document.getElementById('cancelRoleBtn').addEventListener('click', () => Modal.hide('roleModal'));
  document.getElementById('saveRoleBtn').addEventListener('click', handleSaveRole);
  
  // Role option selection
  document.querySelectorAll('.role-option').forEach(option => {
    option.addEventListener('click', function() {
      document.querySelectorAll('.role-option').forEach(opt => {
        opt.style.borderColor = '#e2e8f0';
      });
      this.style.borderColor = 'var(--primary-light)';
      const radio = this.querySelector('input[type="radio"]');
      if (radio) radio.checked = true;
    });
  });
  
  // Chat
  document.getElementById('sendBtn').addEventListener('click', handleSendMessage);
  document.getElementById('chatInput').addEventListener('keypress', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSendMessage();
    }
  });
  
  // Profile
  document.getElementById('saveProfileBtn').addEventListener('click', handleSaveProfile);
  document.getElementById('uploadAvatarOverlay').addEventListener('click', () => {
    document.getElementById('profilePicInput').click();
  });
  document.getElementById('profilePicInput').addEventListener('change', handleProfilePicChange);
  document.getElementById('changePasswordBtn').addEventListener('click', handleChangePassword);
  
  // Dashboard
  document.getElementById('refreshDashboard').addEventListener('click', () => DashboardManager.loadDashboardData());
  
  // Admin
  document.getElementById('manageUsersBtn').addEventListener('click', handleManageUsers);
  document.getElementById('systemStatsBtn').addEventListener('click', handleSystemStats);
  document.getElementById('manageRolesBtn').addEventListener('click', handleManageRoles);
  document.getElementById('settingsBtn').addEventListener('click', handleSettings);
  document.getElementById('systemHealthBtn').addEventListener('click', handleSystemHealth);
  
  // Language switcher
  document.getElementById('languageBtn').addEventListener('click', function() {
    const dropdown = document.getElementById('languageDropdown');
    dropdown.classList.toggle('show');
  });
  
  document.querySelectorAll('.language-option').forEach(option => {
    option.addEventListener('click', function() {
      const lang = this.dataset.lang;
      LanguageManager.setLanguage(lang);
      document.getElementById('languageDropdown').classList.remove('show');
    });
  });
  
  // Close dropdown when clicking outside
  document.addEventListener('click', function(event) {
    const dropdown = document.getElementById('languageDropdown');
    const btn = document.getElementById('languageBtn');
    if (dropdown && btn && !dropdown.contains(event.target) && !btn.contains(event.target)) {
      dropdown.classList.remove('show');
    }
  });
  
  // Logout
  document.getElementById('sidebarLogout').addEventListener('click', handleLogout);
  
  // Initialize language
  LanguageManager.init();
}

// --- Event Handlers ---
async function handleNavigation(e) {
  const item = e.currentTarget;
  const tab = item.dataset.tab;
  
  // Update active state
  document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
  item.classList.add('active');
  
  // Hide all sections
  document.querySelectorAll('main section').forEach(sec => {
    sec.style.display = 'none';
  });
  
  // Show selected section
  const section = document.getElementById(tab);
  if (section) {
    section.style.display = 'block';
    State.activeTab = tab;
    
    // Load section data
    await loadSectionData(tab);
  }
}

async function handleAuthAction() {
  const email = document.getElementById('modalEmail').value;
  const password = document.getElementById('modalPass').value;
  const isRegisterMode = document.getElementById('registerFields').style.display !== 'none';
  
  // Validation
  if (!Validator.validateEmail(email)) {
    Toast.show('Please enter a valid email address', 'error');
    return;
  }
  
  if (!Validator.validatePassword(password)) {
    Toast.show('Password must be at least 6 characters', 'error');
    return;
  }
  
  try {
    if (isRegisterMode) {
      const firstName = document.getElementById('modalFirstName').value;
      const lastName = document.getElementById('modalLastName').value;
      const grade = document.getElementById('modalGrade').value;
      
      if (!Validator.validateRequired(firstName) || !Validator.validateRequired(lastName)) {
        Toast.show('Please enter your name', 'error');
        return;
      }
      
      if (!Validator.validateRequired(grade)) {
        Toast.show('Please select your grade', 'error');
        return;
      }
      
      await AuthManager.register(email, password, {
        firstName,
        lastName,
        grade
      });
      
      Modal.hide('authModal');
      clearAuthForm();
    } else {
      const rememberMe = document.getElementById('rememberMe').checked;
      await AuthManager.login(email, password, rememberMe);
      Modal.hide('authModal');
      clearAuthForm();
    }
  } catch (error) {
    // Error already handled by AuthManager
  }
}

function toggleRegisterMode() {
  const registerFields = document.getElementById('registerFields');
  const toggleBtn = document.getElementById('toggleRegister');
  const actionBtn = document.getElementById('modalAction');
  
  if (registerFields.style.display === 'none') {
    registerFields.style.display = 'block';
    toggleBtn.textContent = 'Already have an account? Login';
    actionBtn.textContent = 'Register';
  } else {
    registerFields.style.display = 'none';
    toggleBtn.textContent = 'Don\'t have an account? Register';
    actionBtn.textContent = 'Login';
  }
}

async function handleForgotPassword() {
  const email = document.getElementById('modalEmail').value;
  if (!Validator.validateEmail(email)) {
    Toast.show('Please enter your email address', 'error');
    return;
  }
  
  await AuthManager.resetPassword(email);
}

async function handleCreateClub() {
  const name = document.getElementById('clubName').value;
  const abbreviation = document.getElementById('clubAbbreviation').value;
  const leader1 = document.getElementById('clubLeader1').value;
  const description = document.getElementById('clubDescription').value;
  const category = document.getElementById('clubCategory').value;
  const leader2 = document.getElementById('clubLeader2').value;
  
  // Validation
  if (!Validator.validateRequired(name)) {
    Toast.show('Club name is required', 'error');
    return;
  }
  
  if (!Validator.validateRequired(abbreviation)) {
    Toast.show('Club abbreviation is required', 'error');
    return;
  }
  
  if (!Validator.validateRequired(leader1)) {
    Toast.show('Primary leader is required', 'error');
    return;
  }
  
  if (!Validator.validateRequired(description)) {
    Toast.show('Description is required', 'error');
    return;
  }
  
  try {
    await ClubManager.createClub({
      name,
      abbreviation,
      leader1,
      leader2,
      description,
      category
    });
    
    Modal.hide('createClubModal');
    clearClubForm();
    loadSectionData('clubs');
  } catch (error) {
    // Error already handled by ClubManager
  }
}

async function handleCreateProject() {
  const title = document.getElementById('projectTitle').value;
  const description = document.getElementById('projectDescription').value;
  const deadline = document.getElementById('projectDeadline').value;
  const status = document.getElementById('projectStatus').value;
  
  // Validation
  if (!Validator.validateRequired(title)) {
    Toast.show('Project title is required', 'error');
    return;
  }
  
  if (!Validator.validateRequired(description)) {
    Toast.show('Description is required', 'error');
    return;
  }
  
  try {
    await ProjectManager.createProject({
      title,
      description,
      deadline: deadline || null,
      status
    });
    
    Modal.hide('createProjectModal');
    clearProjectForm();
    loadSectionData('projects');
  } catch (error) {
    // Error already handled by ProjectManager
  }
}

async function handleSaveProfile() {
  const name = document.getElementById('profileName').value;
  const grade = document.getElementById('profileGrade').value;
  const bio = document.getElementById('profileBio').value;
  const phone = document.getElementById('profilePhone').value;
  const location = document.getElementById('profileLocation').value;
  
  if (!Validator.validateRequired(name)) {
    Toast.show('Name is required', 'error');
    return;
  }
  
  const updates = {
    name,
    grade,
    bio,
    phone,
    location,
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  };
  
  const success = await UserManager.updateUserProfile(State.currentUser.uid, updates);
  if (success) {
    Toast.show('Profile saved successfully!', 'success');
    updateUIForUser({ ...State.userData, ...updates });
  }
}

async function handleChangePassword() {
  const newPassword = prompt('Enter new password (min 6 characters):');
  if (!newPassword) return;
  
  if (!Validator.validatePassword(newPassword)) {
    Toast.show('Password must be at least 6 characters', 'error');
    return;
  }
  
  const confirmPassword = prompt('Confirm new password:');
  if (newPassword !== confirmPassword) {
    Toast.show('Passwords do not match', 'error');
    return;
  }
  
  try {
    await State.currentUser.updatePassword(newPassword);
    Toast.show('Password changed successfully!', 'success');
  } catch (error) {
    Toast.show('Failed to change password', 'error');
  }
}

async function handleSendMessage() {
  const input = document.getElementById('chatInput');
  const message = input.value.trim();
  
  if (!message) return;
  
  try {
    await db.collection('messages').add({
      text: message,
      sender: State.currentUser.uid,
      senderEmail: State.currentUser.email,
      senderName: State.userData.name,
      timestamp: firebase.firestore.FieldValue.serverTimestamp(),
      readBy: [State.currentUser.uid]
    });
    
    input.value = '';
  } catch (error) {
    Toast.show('Failed to send message', 'error');
  }
}

async function handleManageUsers() {
  Loading.show('Loading users...');
  
  try {
    const snapshot = await db.collection('users').get();
    const users = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    
    displayUsersTable(users);
  } catch (error) {
    Toast.show('Failed to load users', 'error');
  } finally {
    Loading.hide();
  }
}

function displayUsersTable(users) {
  const container = document.getElementById('adminContent');
  
  container.innerHTML = `
    <div class="admin-table-container">
      <table class="admin-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Grade</th>
            <th>Role</th>
            <th>Status</th>
            <th>Joined</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          ${users.map(user => `
            <tr>
              <td>${user.name}</td>
              <td>${user.email}</td>
              <td>${user.grade || '-'}</td>
              <td><span class="role-badge ${user.role}">${user.role}</span></td>
              <td><span class="status-badge ${user.status || 'active'}">${user.status || 'Active'}</span></td>
              <td>${user.createdAt ? user.createdAt.toDate().toLocaleDateString() : '-'}</td>
              <td>
                <button class="btn sm" onclick="openRoleModal('${user.id}', '${user.name}', '${user.role}')">
                  Change Role
                </button>
              </td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    </div>
  `;
}

function openRoleModal(userId, userName, currentRole) {
  document.getElementById('roleUserInfo').innerHTML = `
    <div><strong>User:</strong> ${userName}</div>
    <div><strong>Current Role:</strong> <span class="role-badge ${currentRole}">${currentRole}</span></div>
  `;
  
  // Set current role as selected
  document.querySelectorAll('.role-option').forEach(option => {
    const radio = option.querySelector('input[type="radio"]');
    if (radio && radio.value === currentRole) {
      option.style.borderColor = 'var(--primary-light)';
      radio.checked = true;
    } else {
      option.style.borderColor = '#e2e8f0';
    }
  });
  
  document.getElementById('roleNotes').value = '';
  State.roleModalUserId = userId;
  Modal.show('roleModal');
}

async function handleSaveRole() {
  const selectedRadio = document.querySelector('input[name="userRole"]:checked');
  if (!selectedRadio) {
    Toast.show('Please select a role', 'error');
    return;
  }
  
  const newRole = selectedRadio.value;
  
  const success = await UserManager.updateUserRole(State.roleModalUserId, newRole);
  if (success) {
    Modal.hide('roleModal');
    handleManageUsers(); // Refresh table
  }
}

async function handleSystemStats() {
  Loading.show('Loading statistics...');
  
  try {
    const [users, projects, clubs, messages] = await Promise.all([
      db.collection('users').get(),
      db.collection('projects').get(),
      db.collection('clubs').get(),
      db.collection('messages').get()
    ]);
    
    const container = document.getElementById('adminContent');
    
    container.innerHTML = `
      <div class="dashboard-grid">
        <div class="dashboard-widget">
          <div class="widget-header">
            <div class="widget-icon">
              <span class="material-symbols-outlined">people</span>
            </div>
            <div class="widget-title">Total Users</div>
          </div>
          <div class="widget-value">${users.size}</div>
        </div>
        
        <div class="dashboard-widget">
          <div class="widget-header">
            <div class="widget-icon">
              <span class="material-symbols-outlined">work</span>
            </div>
            <div class="widget-title">Active Projects</div>
          </div>
          <div class="widget-value">${projects.size}</div>
        </div>
        
        <div class="dashboard-widget">
          <div class="widget-header">
            <div class="widget-icon">
              <span class="material-symbols-outlined">groups</span>
            </div>
            <div class="widget-title">Clubs</div>
          </div>
          <div class="widget-value">${clubs.size}</div>
        </div>
        
        <div class="dashboard-widget">
          <div class="widget-header">
            <div class="widget-icon">
              <span class="material-symbols-outlined">chat</span>
            </div>
            <div class="widget-title">Messages</div>
          </div>
          <div class="widget-value">${messages.size}</div>
        </div>
      </div>
    `;
  } catch (error) {
    Toast.show('Failed to load statistics', 'error');
  } finally {
    Loading.hide();
  }
}

function handleLogout() {
  auth.signOut();
}

function handleProfilePicChange(e) {
  const file = e.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    const img = document.getElementById('profilePic');
    img.src = e.target.result;
    img.style.display = 'block';
    document.getElementById('profileAvatarFallback').style.display = 'none';
  };
  reader.readAsDataURL(file);
}

// --- UI Update Functions ---
function updateUIForUser(userData) {
  State.userData = userData;
  
  // Update sidebar
  document.getElementById('sideName').textContent = userData.name || 'Guest';
  document.getElementById('sideRole').textContent = getRoleDisplay(userData.role);
  
  // Update profile avatar initials
  const initials = getInitials(userData.name || 'GU');
  document.getElementById('sideProfileInitials').textContent = initials;
  document.getElementById('profileAvatarFallback').textContent = initials;
  
  // Update topbar
  document.getElementById('welcomeText').textContent = `Welcome, ${userData.firstName || userData.name || 'User'}`;
  document.getElementById('welcomeSub').textContent = getRoleDisplay(userData.role) + ' Dashboard';
  
  // Update login/logout buttons
  document.getElementById('openLogin').style.display = 'none';
  document.getElementById('sidebarLogout').style.display = 'block';
  
  // Show/hide admin features
  const isAdmin = userData.role === 'admin' || userData.role === 'owner';
  document.querySelectorAll('.admin-only').forEach(el => {
    el.style.display = isAdmin ? 'block' : 'none';
  });
  
  // Update profile form
  document.getElementById('profileName').value = userData.name || '';
  document.getElementById('profileEmail').value = userData.email || '';
  document.getElementById('profileGrade').value = userData.grade || '';
  document.getElementById('profileBio').value = userData.bio || '';
  document.getElementById('profilePhone').value = userData.phone || '';
  document.getElementById('profileLocation').value = userData.location || '';
  
  // Load initial data
  DashboardManager.loadDashboardData();
  loadClubs();
}

function updateUIForGuest() {
  State.userData = null;
  
  // Update sidebar
  document.getElementById('sideName').textContent = 'Guest User';
  document.getElementById('sideRole').textContent = 'Not signed in';
  document.getElementById('sideProfileInitials').textContent = 'GU';
  
  // Update topbar
  document.getElementById('welcomeText').textContent = 'Welcome';
  document.getElementById('welcomeSub').textContent = 'Please sign in';
  
  // Update login/logout buttons
  document.getElementById('openLogin').style.display = 'block';
  document.getElementById('sidebarLogout').style.display = 'none';
  
  // Hide admin features
  document.querySelectorAll('.admin-only').forEach(el => {
    el.style.display = 'none';
  });
  
  // Reset profile form
  document.getElementById('profileName').value = '';
  document.getElementById('profileEmail').value = '';
  document.getElementById('profileGrade').value = '';
  document.getElementById('profileBio').value = '';
  document.getElementById('profilePhone').value = '';
  document.getElementById('profileLocation').value = '';
  document.getElementById('profilePic').style.display = 'none';
  document.getElementById('profileAvatarFallback').style.display = 'block';
  document.getElementById('profileAvatarFallback').textContent = 'GU';
  
  // Reset dashboard
  document.getElementById('widgetProjects').textContent = '0';
  document.getElementById('widgetClubs').textContent = '0';
  document.getElementById('widgetAssignments').textContent = '0';
  document.getElementById('widgetActivity').textContent = '0';
  document.getElementById('recentActivity').innerHTML = '<div class="list-item">No recent activity</div>';
}

function getInitials(name) {
  return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2) || 'GU';
}

function getRoleDisplay(role) {
  const t = translations[State.currentLanguage];
  const roles = {
    student: t.student,
    leader: t.leader,
    admin: t.admin,
    owner: 'System Owner',
    guest: 'Guest'
  };
  return roles[role] || 'User';
}

// --- Section Loading ---
async function loadSectionData(section) {
  switch(section) {
    case 'dashboard':
      await DashboardManager.loadDashboardData();
      break;
    case 'projects':
      await loadProjects();
      break;
    case 'clubs':
      await loadClubs();
      break;
    case 'profile':
      // Profile data is already loaded
      break;
    case 'admin':
      // Default to user management
      handleManageUsers();
      break;
  }
}

async function loadProjects() {
  if (!State.currentUser) return;
  
  const projects = await ProjectManager.loadProjects();
  const container = document.getElementById('projectsList');
  
  if (!projects.length) {
    container.innerHTML = '<div class="list-item">No projects yet. Create one to get started!</div>';
    return;
  }
  
  container.innerHTML = projects.map(project => `
    <div class="list-item">
      <div class="list-item-content">
        <div class="list-item-title">${project.title}</div>
        <div class="list-item-subtitle">${project.description}</div>
        <div class="list-item-meta">
          <span>Created: ${project.createdAt.toDate().toLocaleDateString()}</span>
          <span>Status: ${project.status}</span>
        </div>
      </div>
      <div class="list-item-actions">
        <button class="btn sm ghost">View</button>
        <button class="btn sm primary">Edit</button>
      </div>
    </div>
  `).join('');
}

async function loadClubs() {
  const clubs = await ClubManager.loadClubs();
  const container = document.getElementById('clubsList');
  
  if (!clubs.length) {
    container.innerHTML = '<div class="club-card">No clubs yet. Admins can create clubs.</div>';
    return;
  }
  
  container.innerHTML = clubs.map(club => {
    const isMember = State.currentUser && club.members.includes(State.currentUser.uid);
    
    return `
      <div class="club-card">
        <div class="club-header">
          <div class="club-logo"><span class="material-symbols-outlined">groups</span></div>
          <div class="club-info">
            <h3 class="club-name">${club.name}</h3>
            <p class="club-abbr">${club.abbreviation}</p>
            <p class="club-leaders">Leaders: ${club.leader1}${club.leader2 ? `, ${club.leader2}` : ''}</p>
            <p class="club-description">${club.description}</p>
          </div>
        </div>
        <div class="club-stats">
          <div class="club-stat">
            <div class="club-stat-value">${club.memberCount}</div>
            <div class="club-stat-label">Members</div>
          </div>
          <div class="club-stat">
            <div class="club-stat-value">${club.funds || 0} DH</div>
            <div class="club-stat-label">Funds</div>
          </div>
          <div class="club-stat">
            <div class="club-stat-value">${club.projects ? club.projects.length : 0}</div>
            <div class="club-stat-label">Projects</div>
          </div>
          <div class="club-stat">
            <div class="club-stat-value">${club.events ? club.events.length : 0}</div>
            <div class="club-stat-label">Events</div>
          </div>
        </div>
        <div class="club-actions">
          ${isMember ? 
            '<button class="btn sm success">Already Joined</button>' : 
            `<button class="btn sm primary" onclick="ClubManager.joinClub('${club.id}')">Join Club</button>`
          }
          <button class="btn sm ghost">View Club</button>
        </div>
      </div>
    `;
  }).join('');
}

// --- Form Clearing Functions ---
function clearAuthForm() {
  document.getElementById('modalEmail').value = '';
  document.getElementById('modalPass').value = '';
  document.getElementById('modalFirstName').value = '';
  document.getElementById('modalLastName').value = '';
  document.getElementById('modalGrade').value = '';
  document.getElementById('registerFields').style.display = 'none';
  document.getElementById('toggleRegister').textContent = 'Don\'t have an account? Register';
  document.getElementById('modalAction').textContent = 'Login';
}

function clearClubForm() {
  document.getElementById('clubName').value = '';
  document.getElementById('clubAbbreviation').value = '';
  document.getElementById('clubLeader1').value = '';
  document.getElementById('clubLeader2').value = '';
  document.getElementById('clubDescription').value = '';
  document.getElementById('clubCategory').value = 'academic';
}

function clearProjectForm() {
  document.getElementById('projectTitle').value = '';
  document.getElementById('projectDescription').value = '';
  document.getElementById('projectDeadline').value = '';
  document.getElementById('projectStatus').value = 'planning';
}

// --- Initialize the application ---
document.addEventListener('DOMContentLoaded', () => {
  initUI();
  
  // Set up auth state listener
  auth.onAuthStateChanged(async (user) => {
    if (user) {
      State.currentUser = user;
      const userData = await UserManager.getUserData(user.uid);
      
      if (userData) {
        State.userData = userData;
        State.userRole = userData.role || 'student';
        updateUIForUser(userData);
      } else {
        // User document doesn't exist, create it
        const defaultUserData = {
          uid: user.uid,
          email: user.email,
          name: user.email.split('@')[0],
          role: 'student',
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
          status: 'active'
        };
        
        await db.collection('users').doc(user.uid).set(defaultUserData);
        State.userData = defaultUserData;
        State.userRole = 'student';
        updateUIForUser(defaultUserData);
      }
      
      // Set up chat listener if on conversations page
      if (State.activeTab === 'conversations') {
        db.collection('messages')
          .orderBy('timestamp', 'desc')
          .limit(50)
          .onSnapshot(snapshot => {
            const messages = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            updateChatUI(messages.reverse());
          });
      }
    } else {
      State.currentUser = null;
      State.userData = null;
      State.userRole = 'guest';
      updateUIForGuest();
    }
  });
  
  // Initialize toast container
  if (!document.getElementById('toastContainer')) {
    const container = document.createElement('div');
    container.id = 'toastContainer';
    container.className = 'toast-container';
    document.body.appendChild(container);
  }
  
  // Show welcome message
  setTimeout(() => {
    Toast.show('Welcome to BNI Yekhlef Student Portal!', 'info', 3000);
  }, 1000);
});

// --- Chat UI Update ---
function updateChatUI(messages) {
  const container = document.getElementById('chatWindow');
  if (!container) return;
  
  container.innerHTML = messages.map(msg => {
    const isSent = msg.sender === State.currentUser.uid;
    return `
      <div class="message ${isSent ? 'sent' : ''}">
        <div class="meta">
          <span class="message-sender">${msg.senderName}</span>
          <span class="message-time">${msg.timestamp ? msg.timestamp.toDate().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 'Just now'}</span>
        </div>
        <div class="message-text">${msg.text}</div>
      </div>
    `;
  }).join('');
  
  container.scrollTop = container.scrollHeight;
}

// Placeholder functions for unimplemented features
function handleSettings() { Toast.show('Feature coming soon', 'info'); }
function handleSystemHealth() { Toast.show('Feature coming soon', 'info'); }
function handleManageRoles() { handleManageUsers(); }

// Export for debugging
window.AppState = State;
</script>
</body>
</html>
